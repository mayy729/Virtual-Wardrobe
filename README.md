# 虚拟衣柜系统 - 为C小姐定制

## 项目简介

这是一个专为C小姐定制的虚拟衣柜管理系统，帮助她轻松管理衣物，快速创建完美搭配，告别选择困难症。系统采用Hello Kitty主题设计，界面美观友好，操作简单直观。

## 快速开始

```bash
# 1. 安装依赖
cd server
npm install

# 2. 配置 MongoDB（可选，但推荐用于数据持久化）
# 设置环境变量 MONGODB_URI
# 或在 server/.env 文件中添加：MONGODB_URI=your_mongodb_connection_string

# 3. 启动后端服务器
npm run dev

# 4. 在浏览器中打开
# 方式1：使用本地服务器（推荐）
python -m http.server 8080
# 访问 http://localhost:8080/docs/index.html

# 方式2：直接打开文件
# 打开 docs/index.html
```

后端服务器将在 `http://localhost:3000` 运行，前端会自动连接。

**首次使用：**
1. 访问登录页面创建账户
2. 登录后即可开始使用所有功能

## 功能特性

### ✨ 核心功能

1. **🔐 用户认证系统**
   - 用户注册和登录
   - 密码加密存储（bcrypt）
   - 忘记密码功能
   - 会话管理和安全令牌
   - 多用户数据隔离

2. **📤 上传衣物**
   - 支持多图片上传（JPG, PNG, GIF, WebP, HEIC, HEIF）
   - 拖拽上传功能
   - 图片预览
   - 支持所有设备（包括 Apple 设备）
   - 类型选择（衣物/配饰）

3. **🎨 自动抠图**
   - 智能背景移除
   - 让衣物展示更美观

4. **🏷️ 分类管理**
   - **类型分类**：衣物（Clothes）或配饰（Accessories）
   - **季节分类**：支持多选（春季、夏季、秋季、冬季、四季）
   - **场合分类**：支持多选（日常、约会、工作、聚会、正式、运动、所有场合）
   - **详细信息**：品牌、尺寸、材质标注
   - **备注功能**：自由添加备注信息

5. **✏️ 编辑功能**
   - 直接在衣柜中编辑物品信息
   - 修改季节、场合、品牌、尺寸、材质、备注
   - 添加或更换穿着效果照片
   - 编辑保存的搭配信息

6. **🔍 智能筛选**
   - **类型筛选**：衣物/配饰
   - **季节筛选**：多选支持，智能"所有季节"逻辑
   - **场合筛选**：多选支持，智能"所有场合"逻辑
   - **品牌筛选**：文本搜索
   - **尺寸筛选**：文本搜索
   - **材质筛选**：文本搜索
   - **关键词搜索**：搜索名称、品牌、备注
   - 实时筛选结果

7. **✨ 创建搭配**
   - 从衣柜中选择衣物
   - 拖拽或点击添加
   - 实时预览搭配效果
   - 使用筛选器快速找到所需物品

8. **💾 保存搭配**
   - 保存喜爱的搭配方案
   - 命名和分类搭配
   - 多选季节和场合
   - 按季节和场合筛选已保存搭配
   - 编辑已保存的搭配信息

9. **📷 穿着照片**
   - 可选添加穿着效果照片
   - 方便查看实际穿着效果
   - 支持在编辑时添加或更换

10. **⚙️ 设置管理**
    - 个人信息管理（修改用户名、更换头像）
    - 密码修改
    - API 配置
    - 登出功能

11. **📖 帮助和支持**
    - 详细的使用教程
    - 功能说明和操作指南
    - 故障排除指南
    - 联系支持

### 🎨 设计特色

- Hello Kitty主题风格
- 粉色系配色方案
- 响应式设计，支持电脑、平板、手机
- 流畅的动画效果
- 友好的用户界面

## 文件结构

```
CSIA/
├── docs/                          # 前端文件
│   ├── index.html                 # 首页/登录页
│   ├── upload.html                # 上传页面
│   ├── wardrobe.html              # 衣柜页面
│   ├── outfit.html                # 创建搭配页面
│   ├── saved.html                 # 已保存搭配页面
│   ├── help.html                  # 帮助页面
│   ├── styles.css                 # 样式文件
│   ├── script.js                  # 通用脚本
│   ├── config.js                  # API配置管理
│   ├── config-ui.js               # 配置界面脚本
│   ├── api.js                     # API客户端
│   ├── auth.js                    # 认证相关脚本
│   ├── settings-ui.js             # 设置界面脚本
│   ├── index-script.js            # 首页脚本
│   ├── upload-script.js           # 上传页面脚本
│   ├── wardrobe-script.js         # 衣柜页面脚本
│   ├── outfit-script.js           # 搭配页面脚本
│   ├── saved-script.js            # 保存搭配页面脚本
│   ├── help-script.js             # 帮助页面脚本
│   ├── README.md                  # 说明文档
│   ├── TESTING.md                 # 测试文档
│   ├── API_CONFIG.md              # API配置文档
│   └── [图片资源文件]
├── server/                         # 后端服务器
│   ├── server.js                  # Express服务器
│   ├── db.js                      # MongoDB连接和模型
│   ├── storage.js                 # 数据存储模块
│   ├── users.js                   # 用户管理模块
│   ├── users-mongo.js             # MongoDB用户存储
│   ├── package.json               # 依赖配置
│   ├── package-lock.json          # 依赖锁定文件
│   └── .gitignore                 # Git忽略配置
└── .gitignore                     # 根目录Git配置
```

## 安装和运行

### 前置要求

- Node.js (v14 或更高版本)
- npm (Node.js 自带)
- MongoDB Atlas 账户（推荐，用于数据持久化）或使用本地文件存储

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone https://github.com/mayy729/Virtual-Wardrobe.git
   cd Virtual-Wardrobe
   ```

2. **安装后端依赖**
   ```bash
   cd server
   npm install
   ```

3. **配置 MongoDB（推荐）**
   - 创建 MongoDB Atlas 账户和集群
   - 获取连接字符串
   - 设置环境变量 `MONGODB_URI` 或在 `server/.env` 文件中添加
   - 详细步骤请参考 `server/MONGODB_QUICK_START.md`

4. **启动后端服务器**
   ```bash
   # 开发模式（自动重启）
   npm run dev
   
   # 或生产模式
   npm start
   ```
   服务器将在 `http://localhost:3000` 启动

5. **打开前端页面**
   - 方式1：使用本地服务器（推荐）
     ```bash
     # 在项目根目录运行
     python -m http.server 8080
     # 然后访问 http://localhost:8080/docs/index.html
     ```
   - 方式2：直接打开文件
     - 打开 `docs/index.html` 文件
     - 系统会自动连接到 `http://localhost:3000`

### API 配置

系统支持灵活的 API Base URL 配置：

- **URL 参数方式**：`index.html?apiBase=http://localhost:3000`
- **配置界面**：点击首页的 "⚙️ Settings" 按钮
- **控制台方式**：`await setWardrobeApiBase('http://your-api-url')`

详细配置说明请查看 [API_CONFIG.md](./API_CONFIG.md)

## ⚠️ GitHub Pages 部署说明

### 重要限制

**GitHub Pages 只提供静态文件托管，无法运行 Node.js 后端服务器。**

这意味着：
- ✅ 前端页面可以正常显示
- ❌ 无法直接使用后端 API 功能（上传、保存、查看等）
- ❌ 无法在 GitHub Pages 上运行后端服务器

### 解决方案

#### 方案 1：本地运行后端（推荐用于个人使用）

1. **在本地启动后端服务器**：
   ```bash
   cd server
   npm install
   npm run dev
   ```

2. **配置前端连接本地后端**：
   - 访问 GitHub Pages：`https://mayy729.github.io/Virtual-Wardrobe/`
   - 点击 "⚙️ Settings" 按钮
   - 输入后端地址：`http://localhost:3000`
   - 点击 "测试连接" 验证
   - 点击 "保存配置"

3. **或使用 URL 参数**：
   ```
   https://mayy729.github.io/Virtual-Wardrobe/?apiBase=http://localhost:3000
   ```

**注意**：此方案需要本地运行后端服务器，适合个人使用。

#### 方案 2：部署后端到云服务器（推荐用于生产环境）

将后端部署到支持 Node.js 的云服务：

**选项 A：Render（免费）**
1. 在 [Render](https://render.com) 创建账户
2. 连接 GitHub 仓库
3. 创建新的 Web Service
4. 选择 `server` 目录
5. 设置构建命令：`npm install`
6. 设置启动命令：`npm start`
7. 获取部署后的 URL（如：`https://your-app.onrender.com`）
8. 在前端配置中设置该 URL

**选项 B：Heroku**
1. 在 [Heroku](https://heroku.com) 创建账户
2. 安装 Heroku CLI
3. 在 `server` 目录运行：
   ```bash
   heroku create your-app-name
   git push heroku main
   ```
4. 获取 Heroku URL 并配置到前端

**选项 C：Railway、Fly.io 等其他平台**
- 类似步骤，将后端部署到云服务
- 确保配置 CORS 允许来自 GitHub Pages 的请求

#### 方案 3：使用 Serverless Functions（高级）

使用 Vercel、Netlify Functions 等将后端 API 转换为 Serverless Functions。

### 配置 CORS

如果后端部署在云服务器上，需要确保后端允许来自 GitHub Pages 的跨域请求。检查 `server/server.js` 中的 CORS 配置：

```javascript
app.use(cors({
    origin: ['https://mayy729.github.io', 'http://localhost:8080'],
    // ...
}));
```

### 故障排除

如果访问 GitHub Pages 时看到 "Unable to load wardrobe data" 错误：

1. **检查后端是否运行**：确保后端服务器正在运行
2. **检查 API 配置**：点击 "⚙️ Settings" 确认 API Base URL 正确
3. **检查 CORS 设置**：确保后端允许来自 GitHub Pages 的请求
4. **查看浏览器控制台**：按 F12 查看具体错误信息

## 使用方法

### 1. 创建账户和登录

1. 首次访问系统会显示登录页面
2. 点击"Register now"创建新账户
3. 输入用户名（3-20字符）和密码（至少6字符）
4. 确认密码后点击"Register"
5. 注册成功后自动登录
6. 如果忘记密码，点击"Forgot Password"进行重置

### 2. 上传衣物

1. 点击导航栏中的"上传衣物"
2. 点击上传区域或拖拽图片文件
3. 选择图片后，填写衣物信息：
   - **类型**：选择"Clothes"或"Accessories"（必选）
   - **名称**：给物品起个名字（必填）
   - **季节**：使用复选框多选（春季、夏季、秋季、冬季、四季）
   - **场合**：使用复选框多选（日常、约会、工作、聚会、正式、运动、所有场合）
   - **品牌**：输入品牌名称（可选）
   - **尺寸**：输入尺寸（可选，如"M"或"38"）
   - **材质**：输入材质（可选，如"Cotton"）
   - **备注**：添加备注信息（可选）
   - **穿着照片**：可选添加穿着效果照片
4. 点击"自动抠图"按钮可移除背景（可选）
5. 点击"保存衣物"完成上传

### 3. 查看和管理衣柜

1. 点击"我的衣柜"查看所有衣物
2. 使用筛选器查找特定衣物：
   - **类型筛选**：选择"Clothes"或"Accessories"
   - **季节筛选**：多选季节（支持"所有季节"逻辑）
   - **场合筛选**：多选场合（支持"所有场合"逻辑）
   - **品牌/尺寸/材质筛选**：输入文本搜索
   - **关键词搜索**：搜索名称、品牌、备注
3. 点击"查看详情"查看完整信息
4. 点击"编辑"按钮可以修改物品的所有信息
5. 可以删除不需要的衣物

### 4. 创建搭配

1. 点击"创建搭配"
2. 使用筛选器在左侧衣柜中查找所需物品
3. 点击物品添加到搭配区域
4. 可以再次点击移除物品
5. 点击"保存搭配"按钮
6. 填写搭配信息：
   - **名称**：给搭配起个名字
   - **季节**：使用复选框多选
   - **场合**：使用复选框多选
   - **备注**：添加备注（可选）
7. 保存成功

### 5. 查看和管理已保存搭配

1. 点击"已保存搭配"
2. 使用筛选功能查找特定搭配：
   - **季节筛选**：多选季节
   - **场合筛选**：多选场合
   - **关键词搜索**：搜索搭配名称或备注
3. 点击"查看详情"查看完整搭配信息
4. 点击"编辑"按钮可以修改搭配信息（名称、季节、场合、备注）
5. 可以删除不需要的搭配

### 6. 账户设置

1. 在首页点击"⚙️ Settings"按钮
2. **个人信息**：修改用户名、更换头像
3. **密码修改**：更改账户密码
4. **API配置**：配置后端服务器地址
5. **登出**：退出当前账户

### 7. 获取帮助

1. 点击导航栏中的"Help"或访问帮助页面
2. 查看详细的使用教程
3. 了解所有功能的使用方法
4. 查看故障排除指南
5. 如需帮助，可通过联系表单发送消息

## 筛选功能说明

系统提供以下筛选器（超过7种）：

1. **类型筛选**：衣物（Clothes）或配饰（Accessories）
2. **季节筛选**：支持多选（春季、夏季、秋季、冬季、四季）
   - 选择"所有季节"：显示所有物品
   - 选择特定季节：显示匹配该季节或标记为"所有季节"的物品
   - 多选：显示匹配任一选中季节的物品
3. **场合筛选**：支持多选（日常、约会、工作、聚会、正式、运动、所有场合）
   - 选择"所有场合"：显示所有物品
   - 选择特定场合：显示匹配该场合或标记为"所有场合"的物品
   - 多选：显示匹配任一选中场合的物品
4. **品牌筛选**：通过文本输入搜索品牌（部分匹配）
5. **尺寸筛选**：通过文本输入搜索尺寸（部分匹配）
6. **材质筛选**：通过文本输入搜索材质（部分匹配）
7. **关键词搜索**：搜索衣物名称、品牌、备注等

**注意**：
- "我的衣柜"和"创建搭配"页面支持所有筛选器
- "已保存搭配"页面仅支持季节和场合筛选
- 所有筛选器可以组合使用，物品必须匹配所有活动筛选器才会显示

## 技术说明

### 技术栈

**前端：**
- HTML5
- CSS3（包含响应式设计和媒体查询）
- JavaScript (原生JS，无框架依赖)
- Fetch API（RESTful API 调用）

**后端：**
- Node.js
- Express.js（Web 框架）
- MongoDB + Mongoose（数据持久化）
- bcrypt（密码加密）
- express-rate-limit（请求频率限制）
- helmet（安全HTTP头）
- CORS（跨域支持）
- 文件存储（JSON，作为MongoDB的备用方案）

### 浏览器兼容性

- Chrome（推荐）
- Firefox
- Safari
- Edge

### 数据存储

**后端存储（MongoDB - 推荐）：**
- 用户数据：存储在 MongoDB Atlas
- 衣物数据：存储在 MongoDB Atlas
- 搭配数据：存储在 MongoDB Atlas
- 数据持久化，永久保存
- 支持多设备共享数据
- 多用户数据隔离

**备用存储（文件系统）：**
- 如果 MongoDB 未配置，系统会使用文件存储
- 衣物数据：`server/wardrobe-data.json`
- 搭配数据：`server/outfits-data.json`
- 用户数据：`server/users-data.json`
- 注意：Render 等免费服务的文件系统是临时的，数据可能丢失

**前端缓存：**
- API Base URL 配置存储在 localStorage
- 用户会话令牌存储在 sessionStorage
- 配置信息持久化保存

### 性能优化

- **分页功能**：衣柜列表支持分页（每页20项），确保100+衣物无卡顿
- **图片懒加载**：使用 `loading="lazy"` 属性，减少初始加载时间
- **搜索节流**：搜索输入250ms延迟，避免频繁触发
- **响应式设计**：支持桌面、平板、手机多设备

### 安全特性

- **用户认证**：
  - 密码使用 bcrypt 加密存储
  - 会话令牌管理
  - 多用户数据隔离
  - 忘记密码功能

- **请求安全**：
  - 请求频率限制（防止暴力破解）
  - Helmet 安全HTTP头
  - CORS 跨域保护
  - 输入验证和清理

- **文件安全**：
  - 文件类型验证：支持 JPG, PNG, GIF, WebP, HEIC, HEIF
  - 文件大小限制：单个文件最大 5MB
  - Base64 大小限制：图片数据最大 10MB
  - 文件名清理和验证

- **数据安全**：
  - 所有文本输入自动清理和长度限制
  - URL 格式验证
  - MongoDB 注入防护
  - 敏感信息加密存储

## 特色功能详解

### 自动抠图功能

系统使用Canvas API实现基础的背景移除功能：
- 自动识别浅色背景并移除
- 对于复杂背景，可以使用专业的背景移除API（需要配置API密钥）

### 响应式设计

- 桌面端：完整功能展示，多列布局
- 平板端：自适应布局，保持良好的视觉效果
- 手机端：单列布局，优化触摸操作

## 使用建议

1. **定期整理**：建议定期检查衣柜，删除不再需要的衣物信息
2. **详细标注**：上传时尽量填写完整信息，便于后续筛选
3. **创建搭配库**：为不同场合创建多个搭配方案
4. **使用备注**：在备注中记录特殊信息（如"借给朋友"等）

## 常见问题

**Q: 数据会丢失吗？**  
A: 如果使用 MongoDB Atlas（推荐），数据会永久保存。如果使用文件存储，在 Render 等免费服务上数据可能会丢失（文件系统是临时的）。强烈建议配置 MongoDB Atlas 以确保数据持久化。

**Q: 支持哪些图片格式？**  
A: 支持 JPG、PNG、GIF、WebP、HEIC、HEIF 格式，单个文件最大 5MB。系统已优化支持 Apple 设备上传。

**Q: 可以批量上传吗？**  
A: 可以，支持一次选择多张图片上传。

**Q: 抠图效果不理想怎么办？**  
A: 可以跳过自动抠图，直接使用原图。对于更好的抠图效果，可以手动使用图片编辑软件处理后再上传。

**Q: 如何更改后端服务器地址？**  
A: 有三种方式：
1. 在首页点击 "⚙️ Settings" 按钮进行配置
2. 在 URL 中添加参数：`?apiBase=http://your-server:3000`
3. 在浏览器控制台执行：`await setWardrobeApiBase('http://your-server:3000')`

**Q: 后端服务器无法启动怎么办？**  
A: 检查以下几点：
1. 确保已安装 Node.js 和 npm
2. 在 `server` 目录运行 `npm install` 安装依赖
3. 检查端口 3000 是否被占用
4. 查看控制台错误信息

**Q: 如何支持 100+ 衣物不卡顿？**  
A: 系统已实现分页功能（每页20项），自动处理大量数据。如果仍有性能问题，可以调整 `wardrobe-script.js` 中的 `ITEMS_PER_PAGE` 值。

**Q: 可以在不同设备上使用吗？**  
A: 可以！只要所有设备连接到同一个后端服务器（或 MongoDB 数据库），数据会自动同步。需要在每个设备上登录相同的账户。

**Q: 如何配置 MongoDB？**  
A: 详细步骤请参考 `server/MONGODB_QUICK_START.md`。基本步骤：
1. 在 MongoDB Atlas 创建账户和集群
2. 获取连接字符串
3. 设置环境变量 `MONGODB_URI`
4. 重启服务器

**Q: 可以编辑已上传的物品吗？**  
A: 可以！在"我的衣柜"页面，点击物品的"查看详情"，然后点击"编辑"按钮即可修改所有信息，包括季节、场合、品牌、尺寸、材质、备注和穿着照片。

**Q: 如何理解"所有季节"和"所有场合"的筛选逻辑？**  
A: 
- 选择"所有季节"：显示所有物品
- 选择特定季节（如"冬季"）：显示标记为"冬季"或"所有季节"的物品
- 多选季节：显示匹配任一选中季节的物品
- 场合筛选逻辑相同

**Q: 忘记密码怎么办？**  
A: 在登录页面点击"Forgot Password"，输入用户名，系统会发送密码重置链接（需要配置邮件服务）或提供临时密码。

## 开发者信息

本项目专为C小姐定制，采用Hello Kitty主题设计，旨在帮助解决衣物搭配的选择困难问题。

## API 文档

### 衣物 API

- `GET /api/clothes` - 获取所有衣物
- `POST /api/clothes` - 创建新衣物
- `PUT /api/clothes/:id` - 更新衣物信息
- `DELETE /api/clothes/:id` - 删除衣物

### 搭配 API

- `GET /api/outfits` - 获取所有搭配
- `POST /api/outfits` - 创建新搭配
- `PUT /api/outfits/:id` - 更新搭配信息
- `DELETE /api/outfits/:id` - 删除搭配

详细 API 配置说明请查看 [API_CONFIG.md](./API_CONFIG.md)

## 测试文档

系统包含完整的测试文档，包括：
- 性能测试方法
- 兼容性测试清单
- 响应式设计测试
- 页面加载时间测试

详细测试说明请查看 [TESTING.md](./TESTING.md)

## 未来改进方向

1. ✅ ~~云端数据同步~~（已实现：MongoDB Atlas）
2. ✅ ~~用户认证和多用户支持~~（已实现）
3. ✅ ~~数据库迁移~~（已实现：MongoDB）
4. ✅ ~~编辑功能~~（已实现）
5. ✅ ~~多选季节和场合~~（已实现）
6. ✅ ~~类型分类（衣物/配饰）~~（已实现）
7. ✅ ~~Apple 设备支持~~（已实现）
8. 集成专业的背景移除API（如 remove.bg）
9. 添加衣物颜色识别功能
10. 智能搭配推荐功能（基于颜色、风格等）
11. 导出搭配为图片功能
12. 图片压缩和优化
13. 离线模式支持（Service Worker）
14. 移动端 App（React Native / Flutter）
15. 邮件服务集成（用于密码重置）

---

**享受穿搭的乐趣，让每一天都充满自信！** 💝
